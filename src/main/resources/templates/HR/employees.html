<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
          integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
            href="https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,100..900;1,9..144,100..900&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Manrope:wght@200..800&family=Playwrite+GB+J:ital,wght@0,100..400;1,100..400&display=swap"
            rel="stylesheet">
    <title>Employees</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

       .attendance-container thead tr {
    background-color: steelblue; /* Dark background color */
    color: white; /* White text */
}

.attendance-container thead tr th {
    padding: 12px;
    text-align: center;
    font-weight:450;
}

.attendance-container tbody tr td {
    padding: 18px;
    text-align: center;
    border-bottom: 1px solid #ccc; /* Adds separation */
}


.attendance-container thead  th:first-child {
    border-top-left-radius: 10px;
    border-bottom-left-radius: 10px;
}

.attendance-container thead  th:last-child {
    border-top-right-radius: 12px;
    border-bottom-right-radius: 12px;
}

      .attendance-container  button:hover {
            background: #0056b3;
        }

        .back-link {
            display: block;
            margin-top: 15px;
            font-size: 14px;
            color: #007bff;
            text-decoration: none;
        }

        .attendance-container{
            width: 80%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
height: 680px;
background: white;
margin-top: 40px;
border-radius: 8px;
box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.229);
align-self: center;
position:relative;
        }
        .page-btns{
        position:absolute;
        right:0;
        bottom:0;
        margin-bottom:20px;
        }
        .page-btns button{
        padding:10px;
       margin-right: 70px;
        }
            .attendance-container tbody tr:nth-child(odd) {
    background-color:transparent; /* Light gray for odd rows */
}
           .submenu{
    display: flex;
    flex-direction: column;
width:10%;
height:100%;
background: transparent;
}
.overflow-menu{
    display:none;
    flex-direction: column;
    background: plum;
    width: 165px;
    height:auto;
    background:white;
    box-shadow: 4px 4px 20px rgba(0,0,0,0.225);
    position: absolute;
    right: 0;
    z-index: 100;
}
.overflow-menu a,button{
    text-decoration: none;
    padding: 14px;
    color: black;

}
.overflow-menu button{
border:none;
background:white;
 padding: 14px;
 font-size:16px;
 font-weight:500;
}
.overflow-menu a:hover{
    background:whitesmoke;
}
.overflow-menu button:hover{
    background:whitesmoke !important;
}
        .submitPopup{
    display:none;
    flex-direction: column;
    gap:20px;
    align-self: center;
    padding: 20px;
    width:900px;
    height:670px;
    background: white;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.229);
   border-radius: 6px;
   position: absolute;
   z-index:1100;


}
        .selected-files-list {

    padding: 10px;
    background-color: #f4f4f4;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    color: gray;
}
.selected-files-list ul {
    list-style-type: none;
    padding: 0;
}
.selected-files-list li {
    padding: 5px 0;
}
.fa-file-pdf {
  color: red;
}

.fa-file-word{
  color: blue;
}

.fa-file-image {
  color: green;
}

.file-section{
    display: flex;
    flex-direction: column;
    gap:14px;
    padding: 10px;
width: 50%;
height: 100%;
border-top-left-radius: 6px;
box-shadow: 2px 2px 18px rgba(0, 0, 0, 0.129);
}
.file-section h3{
    font-weight: 500;
}
.file-drop{
    width:100%;
    height:32%;
    border-radius: 8px;
    border: 2px dashed #ccc;
    padding: 20px;
    text-align: center;
    color: gray;
}
.fa-cloud-arrow-up{
    color: steelblue;
}
.report-section{
    padding: 10px;
    width: 50%;
height: 100%;
background:whitesmoke;
border-left: 1px solid lightgray;
position: relative;
border-top-right-radius: 6px;
box-shadow: 0px 2px 2px 2px 18px rgba(0, 0, 0, 0.129);
}
.report-section span{
    color: red;
}
.report-section input{
    padding: 6px;
    color: gray;
    position: relative;
    z-index: 1000;
}
.report-section label{
    color: gray;
    font-weight: 500;
}

.report-section textarea:focus{
    outline:none;

}

.report-section input:focus{
    outline: steelblue;
    border:2px solid steelblue;
}
.submitReportForm{

    display: flex;
    padding: 0px;
}
        .update-container{
            width:600px;
            margin:auto;
            padding: 15px;
            display: none;
            flex-direction: column;
            gap:10px;
            position:absolute;
height: 600px;
background: white;
border-radius: 8px;
box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.229);
align-self: center;
z-index:1100;

        }
                    .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3);
    z-index: 1000;
    display: none;
}
 .update-container input{
    padding: 5px;

 }
 .update-container p{
    cursor: pointer;
 }
 .update-container label{
    color: gray;
    font-weight: 500;
 }
 .update-container span{
    color: red;
}

    </style>
</head>

<body>
<div class="container">
    <div class="sidebar" style="width:240px !important;font-size:16px;">
        <div class="heading">
            <h2>HR DIVE</h2>
            <button id="chevron" onclick="toggleMenu()" style="background: transparent; border: none;"><i
                    class="fa-solid fa-chevron-left"></i></button>
        </div>
        <h3>Menu</h3>
        <div class="icons">
            <i class="fa-solid fa-house fa-lg "></i> <a href="/dashboard">Dashboard</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-people-group fa-lg"></i><a href="/employees">Employees</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-plus fa-lg"></i> <a href="/contract">New Hire</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-clipboard-list"></i> <a href="/assignedTasks">Tasks</a>
        </div>

        <div class="icons">
            <i class="fa-regular fa-square-check fa-lg "></i> <a href="/Attendances">Attendances</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-arrow-right-from-bracket fa-lg "></i> <a href="/Leaves">Leaves</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-layer-group fa-lg "></i> <a href="/payroll">Payroll</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-bullhorn"></i> <a href="/HRannouncements">Announcements</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-headset fa-lg"></i> <a href="/support">Support Requests</a>
        </div>
        <div class="icons">
            <i class="fa-solid fa-gear fa-lg"></i> <a href="/security">Settings</a>
        </div>

    </div>
    <!-- Navbar -->
    <div class="navigation" >
        <div class="navbar" style="background:whitesmoke" >
            <div class="links">
                <div class="prof">

                    <h3>Welcome back,<span id="employee-name" style="color:steelblue">HR</span></h3>
                </div>
                <div class="links-buttons" style="position:relative;right: 60px;">
                    <form action="/logout" method="POST" style="display: inline;background: transparent;border: none;box-shadow: none;position: relative;top: 14px;">
                        <button type="submit" class="logout-btn">
                            <i class="fa-solid fa-sign-out-alt"></i> Logout
                        </button>
                    </form>

                </div>
            </div>
            <div class="attendance-container">

                <div class="submitPopup" id="submitPopup">
                    <div style="display: flex;justify-content: space-between;align-items:center">
                        <h2>Assign Task</h2>
                        <i class="fa-solid fa-xmark fa-lg" style="color: #0056b3;" id="close-btn"></i>
                    </div>
                    <form style="width: 100%;height:100%;background: whitesmoke;" class="submitReportForm" id="assignNewTask">
                        <div class="file-section">
                            <h3>Upload from your device</h3>
                            <div class="file-drop">

                                <input type="file"  id="fileSelect" style="display: none;"  name="attachment" multiple>
                                <div style="margin-top: 20px;">
                                    <i class="fa-solid fa-cloud-arrow-up fa-3x" style="margin-bottom: 20px;" id="cloud"></i>
                                    <p style="color: gray;"><span style="color: steelblue;">Click to Upload</span> or drag and drop</p>
                                    PNG,JPG or pdf
                                </div>
                            </div>
                            Attachments
                            <div class="selected-files-list" id="selectedFiles"></div>

                        </div>
                        <div class="report-section">
                            <label>Title<span>*</span></label>
                            <input type="text" id="Task-title" name="taskTitle" required >
                            <input type="number" style="display:none;" id="ID" required >
                            <label>Priority<span>*</span></label>
                            <select id="Task-Priority" name="priority" required >
                                <option>Normal</option>
                                <option>Medium</option>
                                <option>High</option>

                            </select>
                            <div style="display: flex;gap: 20px;">
                                <div style="display: flex;flex-direction: column;width: 48%;">
                                    <label>Start Date<span>*</span></label>
                                    <input type="date" id="Task-startDate" >
                                </div>
                                <div style="display: flex;flex-direction: column;width: 48%;">
                                    <label>Due Date<span>*</span></label>
                                    <input type="date" id="Task-dueDate" name="dueDate" required>
                                </div>

                            </div>
                            <label>Description<span>*</span></label>
                            <textarea style="width: 100%;height:48%;position: relative;border-radius: 6px;padding-left: 10px;padding-top: 5px;" name="taskDescription" required></textarea>
                            <button style="width: 90px;height: 35px;text-align:center;margin-top: 4px;" id="sendTask">Submit</button>
                        </div>
                    </form>
                </div>
                <div class="" style="flex">
                    <h2>Employee Records</h2>

                </div>
                <div style="display:flex;gap:8px;position:absolute;right:0;margin-right:80px;align-items:center;margin-top:20px;margin-bottom:30px;">
                    <label style="font-size:18px;color:steelblue;">Filter By:</label><select id="Filter" style="padding:6px;"><option>All</option><option>Approved</option><option>Pending</option><option>Denied</option></select>
                </div>
                <table style="width: 98%; border-collapse: collapse;align-self: center;margin-top: 30px;">
                    <thead>
                    <tr>

                        <th style="padding: 15px;">Employee ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Address</th>
                        <th>Action</th>


                    </tr>
                    </thead>
                    <tbody id="table">

                    </tbody>
                </table>
                <div class="page-btns">
                    <button id="prev-btn" style="width: 90px;height:40px;background: steelblue;color: white;border:none;border-radius: 6px;">Previous</button>
                    <button id="next-btn" style="width: 90px;height:40px;background: steelblue;color: white;border:none;border-radius: 6px;">Next</button>
                </div>
                <div class="update-container" id="update-container">
                </div>
            </div>
        </div>
    </div>
</div>

</div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
     let currentPage = 0;
     const pageSize = 5;
     let employeeId, firstName, lastName, email, phone, address;

     let employmentType, compensationType, paymentRate, salaryType;

     let jobLevel, jobRole, shiftStart, shiftEnd;


     const overlay = document.createElement("div");
     overlay.classList.add("overlay");
     document.body.appendChild(overlay);

     const updateContainer = document.getElementById("update-container");
     const submitPopup = document.getElementById("submitPopup");
     const closeBtn = document.getElementById("close-btn");
     const form = document.getElementById("assignNewTask");
     const fileInput = document.getElementById("fileSelect");
     const selectedFilesContainer = document.getElementById("selectedFiles");
     const sendButton = document.getElementById("sendTask");
     let empID;


     document.getElementById("fileSelect").addEventListener("change", function (event) {
         const fileInput = event.target;
         const selectedFilesContainer = document.getElementById("selectedFiles");

         selectedFilesContainer.innerHTML = '';

         if (fileInput.files.length > 0) {
             Array.from(fileInput.files).forEach(file => {
                 const getFileIconClass = (file) => {
                     if (file.type === 'application/pdf') return 'fa-solid fa-file-pdf';
                     if (file.type === 'application/msword' || file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') return 'fa-solid fa-file-word';
                     if (file.type === 'application/vnd.ms-excel' || file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') return 'fa-solid fa-file-excel';
                     if (file.type === 'application/vnd.ms-powerpoint' || file.type === 'application/vnd.openxmlformats-officedocument.presentationml.presentation') return 'fa-solid fa-file-powerpoint';
                     if (file.type.startsWith('image/')) return 'fa-solid fa-file-image';
                     return 'fa-solid fa-file';
                 };

                 const fileTypeIcon = getFileIconClass(file);
                 const fileDiv = document.createElement("div");
                 fileDiv.classList.add("file-container");
                 fileDiv.innerHTML = `
                     <div style="display:flex;align-items:center;gap:8px;">
                         <i class="${fileTypeIcon}"></i>
                         <p>${file.name}</p>
                     </div>
                 `;
                 selectedFilesContainer.appendChild(fileDiv);
             });
         }
     });

     document.getElementById("cloud").addEventListener("click", function() {
         document.getElementById("fileSelect").click();
     });

     document.addEventListener('click', function(event) {
         if (event.target.id === 'close-btn') {
             updateContainer.style.display = "none";
             overlay.style.display = "none";
         }
     });


     if (closeBtn) {
         closeBtn.addEventListener('click', function() {
             submitPopup.style.display = "none";
             overlay.style.display = "none";
         });
     }


     window.changeForm = function(choice) {
         if (choice === "Payroll") {
             updateContainer.innerHTML = `
                 <div style="display: flex;justify-content: space-between;align-items:center">
                     <h2>Update Employee</h2>
                     <i class="fa-solid fa-xmark fa-lg" style="color: #0056b3;" id="close-btn"></i>
                 </div>
                 <div style="display: flex;gap:10px;">
                     <p onclick="changeForm('Personal')">Personal Details</p>
                     <p onclick="changeForm('Employment')">Employment Details</p>
                     <p style="color: steelblue;cursor: pointer;" onclick="changeForm('Payroll')">Payroll Details</p>
                 </div>
                 <form style="position: relative;height: 100%;display: flex;flex-direction: column;" id="payrollForm">
                     <div style="display: flex;gap:20px;width: 100%;">
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Employment Type<span>*</span></label>
                             <input type="text" style="width:100%;" id="employmentType">
                         </div>
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Salary Type<span>*</span></label>
                             <input type="text" style="width: 100%;" id="salaryType">
                         </div>
                     </div>
                     <div style="display: flex;gap:20px;width: 100%;">
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Compensation Type<span>*</span></label>
                             <input type="text" style="width: 100%;" id="compensationType">
                         </div>
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Payment Rate<span>*</span></label>
                             <input type="text" style="width: 100%;" id="paymentRate">
                         </div>
                     </div>
                     <button style="width: 90px;position: absolute;bottom:0;right: 0;margin-right: 20px;" onclick="updateForm('Compensation')">Update</button>
                 </form>
             `;

             setTimeout(() => {
                 const payrollForm = document.getElementById("payrollForm");
                 if (payrollForm) {
                     document.getElementById("employmentType").value = employmentType || '';
                     document.getElementById("salaryType").value = salaryType || '';
                     document.getElementById("compensationType").value = compensationType || '';
                     document.getElementById("paymentRate").value = paymentRate || '';
                 }
             }, 100);
         }
         else if (choice === "Employment") {
             updateContainer.innerHTML = `
                 <div style="display: flex;justify-content: space-between;align-items:center">
                     <h2>Update Employee</h2>
                     <i class="fa-solid fa-xmark fa-lg" style="color: #0056b3;" id="close-btn"></i>
                 </div>
                 <div style="display: flex;gap:10px;">
                     <p onclick="changeForm('Personal')">Personal Details</p>
                     <p style="color: steelblue;cursor: pointer;" onclick="changeForm('Employment')">Employment Details</p>
                     <p onclick="changeForm('Payroll')">Payroll Details</p>
                 </div>
                 <form style="position: relative;height: 100%;display: flex;flex-direction: column;" id="employmentForm">
                     <div style="display: flex;gap:20px;width: 100%;">
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Job Level<span>*</span></label>
                             <input type="text" style="width:100%;" id="jobLevel">
                         </div>
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Job Role<span>*</span></label>
                             <input type="text" style="width: 100%;" id="jobRole">
                         </div>
                     </div>
                     <div style="display: flex;gap:20px;width: 100%;">
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Shift Start<span>*</span></label>
                             <input type="time" style="width: 100%;" id="shiftStart">
                         </div>
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Shift End<span>*</span></label>
                             <input type="time" style="width: 100%;" id="shiftEnd">
                         </div>
                     </div>
                     <button style="width: 90px;position: absolute;bottom:0;right: 0;margin-right: 20px;" onclick="updateForm('Employment')">Update</button>
                 </form>
             `;


             setTimeout(() => {
                 const employmentForm = document.getElementById("employmentForm");
                 if (employmentForm) {
                     document.getElementById("jobLevel").value = jobLevel || '';
                     document.getElementById("jobRole").value = jobRole || '';
                     document.getElementById("shiftStart").value = shiftStart || '';
                     document.getElementById("shiftEnd").value = shiftEnd || '';
                 }
             }, 100);
         }
         else if (choice === "Personal") {
             updateContainer.innerHTML = `
                 <div style="display: flex;justify-content: space-between;align-items:center">
                     <h2>Update Employee</h2>
                     <i class="fa-solid fa-xmark fa-lg" style="color: #0056b3;" id="close-btn"></i>
                 </div>
                 <div style="display: flex;gap:10px;">
                     <p style="color: steelblue;cursor: pointer;" onclick="changeForm('Personal')">Personal Details</p>
                     <p onclick="changeForm('Employment')">Employment Details</p>
                     <p onclick="changeForm('Payroll')">Payroll Details</p>
                 </div>
                 <form style="position: relative;height: 100%;display: flex;flex-direction: column;" id="personalForm">
                     <div style="display: flex;gap:20px;width: 100%;">
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>First Name<span>*</span></label>
                             <input type="text" style="width:100%;" id="firstName" name="firstName">
                         </div>
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Last Name<span>*</span></label>
                             <input type="text" style="width: 100%;" id="lastName" name="lastName">
                         </div>
                     </div>
                     <div style="display: flex;gap:20px;width: 100%;">
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Email<span>*</span></label>
                             <input type="email" style="width: 100%;" id="email" name="email" readonly>
                         </div>
                         <div style="display: flex;flex-direction: column;flex: 1;">
                             <label>Phone<span>*</span></label>
                             <input type="text" style="width: 100%;" id="phone" name="phone">
                         </div>
                     </div>
                     <label>Address<span>*</span></label>
                     <input type="text" id="address" name="address">
                     <button style="width: 90px;position: absolute;bottom:0;right: 0;margin-right: 20px;" onclick="updateForm('Personal')">Update</button>
                 </form>
             `;


             setTimeout(() => {
                 const personalForm = document.getElementById("personalForm");
                 if (personalForm) {
                     document.getElementById("firstName").value = firstName || '';
                     document.getElementById("lastName").value = lastName || '';
                     document.getElementById("email").value = email || '';
                     document.getElementById("phone").value = phone || '';
                     document.getElementById("address").value = address || '';
                 }
             }, 100);
         }
     };

     window.showUpdatePopup = function() {
         changeForm('Personal');
         updateContainer.style.display = "flex";
         overlay.style.display = "block";
         console.log(employeeId);

         if (employeeId) {

            fetch(`/findPay?uniqueId=${employeeId}`)
               .then(response => {
                   if (!response.ok) {
                       throw new Error('Employee payment details not found');
                   }
                   return response.json();
               })
               .then(data => {
                   employmentType = data.employmentType;
                   compensationType = data.compensationType;
                   paymentRate = data.paymentRate;
                   salaryType = data.salaryType;

                   const payrollForm = document.getElementById("payrollForm");
                   if (payrollForm) {
                       document.getElementById("employmentType").value = employmentType;
                       document.getElementById("salaryType").value = salaryType;
                       document.getElementById("compensationType").value = compensationType;
                       document.getElementById("paymentRate").value = paymentRate;
                   }
               })
               .catch(error => {
                   console.error('Error fetching payment details:', error);

                   employmentType = '';
                   compensationType = '';
                   paymentRate = '';
                   salaryType = '';
               });


            fetch(`/findEmployment?uniqueId=${employeeId}`)
               .then(response => {
                   if (!response.ok) {
                       throw new Error('Employee employment details not found');
                   }
                   return response.json();
               })
               .then(data => {
                   jobLevel = data.jobLevel;
                   jobRole = data.jobRole;
                   shiftStart = data.shiftStart;
                   shiftEnd = data.shiftEnd;

                   const employmentForm = document.getElementById("employmentForm");
                   if (employmentForm) {
                       document.getElementById("jobLevel").value = jobLevel;
                       document.getElementById("jobRole").value = jobRole;
                       document.getElementById("shiftStart").value = shiftStart;
                       document.getElementById("shiftEnd").value = shiftEnd;
                   }
               })
               .catch(error => {
                   console.error('Error fetching employment details:', error);

                   jobLevel = '';
                   jobRole = '';
                   shiftStart = '';
                   shiftEnd = '';
               });
         }
     };


     const fetchData = (currentPage) => {
         fetch(`/EmployeeData?page=${currentPage}&size=${pageSize}`)
             .then((response) => response.json())
             .then((data) => {
                 const container = document.getElementById('table');
                 container.innerHTML = data.content.map((employee) => `
                     <tr>
                         <td style="padding: 15px;">${employee.uniqueId}</td>
                         <td>${employee.firstName}</td>
                         <td>${employee.lastName}</td>
                         <td>${employee.email}</td>
                         <td>${employee.phone}</td>
                         <td>${employee.address}</td>
                         <td style="position: relative;">
                             <div class="submenu">
                                 <button class="overflow-btn" style="background:white;border: none;cursor: pointer;">
                                     <i class="fa-solid fa-ellipsis-vertical fa-lg" style="margin-right: 20px;color:gray;"></i>
                                 </button>
                             </div>
                             <div class="overflow-menu">
                                 <button value="${employee.uniqueId}" class="assignTask">Assign Task</button>
                                 <a href="#" class="submitTaskReport" data-id="${employee.uniqueId}" >Update Employee</a>
                                 <button value="${employee.uniqueId}" class="assign-btn">
                                     Delete Employee
                                 </button>
                             </div>
                         </td>
                     </tr>
                 `).join('');

                 container.addEventListener('click', function(event) {
                     const tr = event.target.closest('tr');
                     if (!tr) return;

                     const tdElements = tr.querySelectorAll('td');
                     employeeId = tdElements[0].textContent.trim();
                     firstName = tdElements[1].textContent.trim();
                     lastName = tdElements[2].textContent.trim();
                     email = tdElements[3].textContent.trim();
                     phone = tdElements[4].textContent.trim();
                     address = tdElements[5].textContent.trim();
                 });


                 document.querySelectorAll('.submitTaskReport').forEach(link => {
                     link.addEventListener('click', function(e) {
                         e.preventDefault();

                         const rowElement = this.closest('tr');
                         if (rowElement) {
                             const tdElements = rowElement.querySelectorAll('td');
                             employeeId = tdElements[0].textContent.trim();
                             firstName = tdElements[1].textContent.trim();
                             lastName = tdElements[2].textContent.trim();
                             email = tdElements[3].textContent.trim();
                             phone = tdElements[4].textContent.trim();
                             address = tdElements[5].textContent.trim();

                             showUpdatePopup();
                         }
                     });
                 });


                 const overflowBtns = document.querySelectorAll('.overflow-btn');
                 overflowBtns.forEach(btn => {
                     btn.addEventListener('click', function(event) {
                         document.querySelectorAll('.overflow-menu').forEach(menu => {
                             menu.style.display = "none";
                         });

                         const menu = this.closest('td').querySelector('.overflow-menu');
                         if (menu) {
                             menu.style.display = menu.style.display === "flex" ? "none" : "flex";
                         }
                         event.stopPropagation();
                     });
                 });


                 document.addEventListener('click', function() {
                     document.querySelectorAll('.overflow-menu').forEach(menu => {
                         menu.style.display = "none";
                     });
                 });


                 const assignTasks = document.querySelectorAll(".assignTask");
                 assignTasks.forEach(assign => {
                     assign.addEventListener('click', function() {
                         submitPopup.style.display = "flex";
                         overlay.style.display = "block";
                         empID = this.value;
                     });
                 });


                 const assignBtns = document.querySelectorAll(".assign-btn");
                 assignBtns.forEach(btn => {
                     btn.addEventListener('click', function(event) {
                         const employeeId = this.value;

                         const confirmDelete = confirm("Are you sure you want to delete this employee?");
                         if (confirmDelete) {
                             fetch("/deleteEmployee", {
                                 method: "DELETE",
                                 headers: { "Content-Type": "application/json" },
                                 body: JSON.stringify({ employeeId })
                             })
                             .then(response => response.json())
                             .then(data => {
                                 console.log(data);
                                 window.location.reload();
                             })
                             .catch((error) => console.error('Error deleting employee:', error));
                         }
                         event.stopPropagation();
                     });
                 });
             })
             .catch((error) => console.error('Error fetching data:', error));
     };


     document.getElementById('prev-btn').addEventListener('click', () => {
         if (currentPage > 0) {
             currentPage--;
             fetchData(currentPage);
         }
     });

     document.getElementById('next-btn').addEventListener('click', () => {
         currentPage++;
         fetchData(currentPage);
     });


     if (sendButton) {
         sendButton.addEventListener('click', function(e) {
             e.preventDefault();

             const formData = new FormData();
             formData.append("uniqueId", empID);
             formData.append("taskTitle", document.getElementById("Task-title").value);
             formData.append("taskDescription", document.querySelector("textarea[name='taskDescription']").value);
             formData.append("priority", document.getElementById("Task-Priority").value);
                formData.append("startDate", document.getElementById("Task-startDate").value);
             formData.append("dueDate", document.getElementById("Task-dueDate").value);

             if (fileInput.files.length > 0) {
                 formData.append("attachment", fileInput.files[0]);
             }

             const taskData = {
                 uniqueId: empID,
                 taskTitle: document.getElementById("Task-title").value,
                 taskDescription: document.querySelector("textarea[name='taskDescription']").value,
                 priority: document.getElementById("Task-Priority").value,
                 startDate:document.getElementById("Task-startDate").value,
                 dueDate: document.getElementById("Task-dueDate").value
             };

             const taskBlob = new Blob([JSON.stringify(taskData)], {
                 type: 'application/json'
             });

             formData.append("task", taskBlob);

             fetch("/assignTask", {
                 method: 'POST',
                 body: formData
             })
             .then(response => {
                 if (response.ok) {
                     return response.json();
                 }
                 throw new Error('Network response was not ok: ' + response.statusText);
             })
             .then(data => {
                 alert("Task assigned successfully!");
                 submitPopup.style.display = "none";
                 overlay.style.display = "none";
                 form.reset();
                 selectedFilesContainer.innerHTML = '';
             })
             .catch(error => {
                 console.error('Error:', error);
                 alert("Failed to assign task. Please try again.");
             });
         });
     }


     window.updateForm = function(formChoice) {
         let endpoint, formData;

         switch(formChoice) {
             case 'Personal':
           endpoint = `/updatePersonal?uniqueId=${employeeId}`;
                 formData = {
                     employeeId: employeeId,
                     firstName: document.getElementById('firstName').value,
                     lastName: document.getElementById('lastName').value,
                     email: document.getElementById('email').value,
                     phone: document.getElementById('phone').value,
                     address: document.getElementById('address').value
                 };
                 break;

             case 'Employment':
                 endpoint = `/updateEmployment?uniqueId=${employeeId}`;
                 formData = {
                     employeeId: employeeId,
                     jobLevel: document.getElementById('jobLevel').value,
                     jobRole: document.getElementById('jobRole').value,
                     shiftStart: document.getElementById('shiftStart').value,
                     shiftEnd: document.getElementById('shiftEnd').value
                 };
                 break;

             case 'Compensation':
                 endpoint = `/updatePayroll?uniqueId=${employeeId}`;
                 formData = {
                     employeeId: employeeId,
                     employmentType: document.getElementById('employmentType').value,
                     salaryType: document.getElementById('salaryType').value,
                     compensationType: document.getElementById('compensationType').value,
                     paymentRate: document.getElementById('paymentRate').value
                 };
                 break;

             default:
                 console.error('Unknown form type');
                 return;
         }

         fetch(endpoint, {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/json'
             },
             body: JSON.stringify(formData)
         })
         .then(response => {
             if (!response.ok) {
                 throw new Error('Network response was not ok');
             }
             return response.json();
         })
         .then(data => {
             console.log(data);
             alert("Employee updated successfully!");
             updateContainer.style.display = "none";
             overlay.style.display = "none";
         })
         .catch(error => {
             console.error('Error updating employee:', error);
             alert("Failed to update employee. Please try again.");
         });
     };

     if (typeof toggleMenu !== 'function') {
         window.toggleMenu = function() {
             console.log("Menu toggle clicked");
         };
     }

     fetchData(currentPage);
  });
</script>
</body>
</html>